[![Build Status](https://travis-ci.org/MrLinQQ/Lunches.svg?branch=master)](https://travis-ci.org/MrLinQQ/Lunches)
# Lunches

## Как ЭТО работает
Гость заходить на главную страницу, видит только календарь и ссылки на регистрацию\вход (Devise). Первый гость, который пройдет регистрацию - станет админом (admin: true будет вызываться после регистрации каждого юзера, если до этого их общее число == 0), при выборе организации у него будет единственный вариант - 'Non-organisation'
* ~~Каждые сутки создается объект класса Day с primary_key :date (формат поля '%Y-%m-%d'), с ассоциацией has_many :orders~~ (пока не стал настраивать heroku dyno, а просто в seeds.rb прописал создание на текущий месяц)
* Юзеры создают заказы
* Админ видит список заказов и стоимость
* Доставка читает api
* Админ расплачивается с доставкой
* Админ взымает убытки от организаций
* Все сыты и довольны (наверное). Completed!!
---

Admin может:

1.Просматривать список всех юзеров и их профиль

2.Работать с организациями:
  * Просматривать список всех организаций и их профиль, вместе с юзерами, состоящими в этой организации
  * Создавать/Изменять/Удалять организации

3.Работать с продуктами:
  * Просматривать список всех продуктов и их профиль
  * Создавать/Изменять/Удалять продукты

4.Работать с меню (изначально в db есть меню 'Daily Menu'):
  * Вносить/Убирать продукты в/из меню

5.Работать с заказами:
  * Просматривать список всех заказов в данный день, их стоимость
---

User может:

1.Просматривать/Редактировать только свой профиль

2.Работать с заказами:
  * Создавать заказ. Один  день - один заказ. Заказ из 3х позиций, одна позиция - один продукт. (В заказе может отсутствовать какая-либо позиция)
  * Просматривать свой заказ
---

API: ```'/api/index'``` - вывод организаций и принадлежащих юзеров, имеющих заказ на сегодня

---

## ToDo
* регистрация через Google App
* haml
* PostgreSQL
* ~~добавить загрузку файлов через Amazon S3 (для Heroku)~~
* ~~gem [whenever](https://github.com/javan/whenever) не работает на Heroku (заюзать [scheduler](https://devcenter.heroku.com/articles/scheduler))~~
* исправить редирект после регистрации первого юзера(Devise)
* ~~исправить таблицу показа всех заказов для админа (продукты отображаются не в своем столбце, если отсутствует продукт на предыдущей позиции)~~
* and Minuses..

## Minuses
- надо было юзать ActiveAdmin :/
- AR N+1
- надо было юзать partials
- самому не нравится логика в views
- ~~правильно было бы спрятать организацию 'Non-organisation' после того, как админ(первый юзер) зарегается~~
- решил не делать has_and_belongs_to_many моделей Product и Order
- ужасный json
- ужасный I18n
- дырка при прямом переходе через url на выходной день
- мб стоило юзать class Date
- наверняка, где-то еще что-то (ツ)
